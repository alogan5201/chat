import{R as t,I as N,f as c,E as A,A as C,M as P,D as B,F as j,P as O,N as U,L as r,a6 as q,a7 as G,a8 as H,v as b,_ as J,a9 as K,aa as p,V as $,ab as Q,ac as W,a2 as X}from"./vendor.5811855d.js";import{a as Y,f}from"./index.310de256.js";function Z(g){const{size:n=15}=g;return t.createElement("span",{className:"double-tick-icon"},t.createElement(N,{f7:"checkmark_alt",size:n,color:"primary"}),t.createElement(N,{f7:"checkmark_alt",size:n,color:"primary"}))}function ae(g){const n=Y.currentUser,{f7route:l}=g,u=l.params.id,v=n.uid;v.concat(u),v.concat(u);const y=c.exports.useRef(null),[o,M]=c.exports.useState([]),[m,k]=c.exports.useState(""),[ee,D]=c.exports.useState(""),I=e=>Intl.DateTimeFormat("en",{hour:"numeric",minute:"numeric"}).format(e.date),R=e=>{const s=o.indexOf(e),a=o[s-1];return!a||a.type!==e.type},x=e=>{const s=o.indexOf(e),a=o[s+1];return!a||a.type!==e.type},L=async()=>{const e=l.params.id,s=n.uid,a=s>e?`${s+e}`:`${e+s}`,i=b(f,"chats",a);await J(i,{messages:K({uid:n.uid,createdAt:new Date,content:m})}),await o.push({uid:n.uid,createdAt:new Date,content:m}),k(""),M([...o]),setTimeout(()=>{y.current.f7Messagebar().focus()})},T=c.exports.useRef(null),w=()=>{p("html, body").css("height",`${visualViewport.height}px`),p("html, body").scrollTop(0)},S=()=>{const{device:e}=$;!e.ios||e.cordova||e.capacitor||(clearTimeout(T.current),visualViewport.addEventListener("resize",w))},z=()=>{const{device:e}=$;!e.ios||e.cordova||e.capacitor||(T.current=setTimeout(()=>{visualViewport.removeEventListener("resize",w),p("html, body").css("height",""),p("html, body").scrollTop(0)},100))},V=async()=>{const e=l.params.id,s=n.uid,a=s>e?`${s+e}`:`${e+s}`,i=b(f,"chats",a);if(!(await Q(i)).exists()){{console.log("data does not exist");const h={createdAt:W.fromDate(new Date),messages:[],users:[s,e]};await X(b(f,"chats",a),h)}D(u)}};return c.exports.useEffect(()=>{A(()=>{const e=C(f,"chats"),s=l.params.id,a=n.uid,i=a>s?`${a+s}`:`${s+a}`;console.log(`id = ${i}`);const F=P(e,B("users","array-contains",a)),h=j(F,E=>{let d=[];E.forEach(_=>{d.push(_.data().messages)}),console.log(d.length),d.length==0&&V(),M(d[0])},E=>{console.log(E)});return()=>h()})},[]),t.createElement(O,{className:"myMessages-page",noToolbar:!0,messagesContent:!0},t.createElement(U,{className:"myMessages-navbar",backLink:!0,backLinkShowText:!1},t.createElement(r,{slot:"right",iconF7:"videocam"}),t.createElement(r,{slot:"right",iconF7:"phone"}),t.createElement(r,{slot:"title",href:`/profile/${u}/`,className:"title-profile-link"},t.createElement("div",null,t.createElement("div",{className:"subtitle"},"online")))),t.createElement(q,{ref:y,placeholder:"",value:m,onInput:e=>k(e.target.value),onFocus:S,onBlur:z},t.createElement(r,{slot:"inner-start",iconF7:"plus"}),t.createElement(r,{className:"messagebar-sticker-link",slot:"after-area",iconF7:"sticker"}),m.trim().length?t.createElement(r,{slot:"inner-end",className:"messagebar-send-link",iconF7:"paperplane_fill",onClick:L}):t.createElement(t.Fragment,null,t.createElement(r,{slot:"inner-end",href:"/camera/",iconF7:"camera"}),t.createElement(r,{slot:"inner-end",iconF7:"mic"}))),t.createElement(G,null,o&&o.map((e,s)=>t.createElement(H,{key:s,"data-key":s,first:R(e),last:x(e),tail:x(e),type:e.uid===n.uid?"sent":"received",text:e.content,className:"message-appear-from-bottom"},t.createElement("span",{slot:"text-footer"},e.type==="sent"&&t.createElement(Z,null),I(e))))))}export{ae as default};
